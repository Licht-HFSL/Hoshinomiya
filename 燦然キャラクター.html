<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <!-- â† ã“ã‚Œã‚’è¿½åŠ  -->
  <title>ç‡¦ç„¶ã®ãƒšãƒªãƒšãƒ†ã‚£ã‚¢ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å›³é‘‘</title>
 <link rel="stylesheet" href="characters.css"> <!-- CSSã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã§èª­ã¿è¾¼ã¿ -->

</head>
<body>
  <h1>ç‡¦ç„¶ã®ãƒšãƒªãƒšãƒ†ã‚£ã‚¢</h1>

 <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header>
    <nav>
      <a href="index.html">ãƒˆãƒƒãƒ—</a>
      <a href="ç‡¦ç„¶ã®ãƒšãƒªãƒšãƒ†ã‚£ã‚¢.html">ä¸–ç•Œæ¦‚è¦</a>
      <!-- å¿…è¦ã«å¿œã˜ã¦ä½œå“ã‚’è¿½åŠ  -->
    </nav>
  </header>


  <!-- ğŸ” æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div class="filters">
    <input type="text" id="searchBox" placeholder="åå‰ã§æ¤œç´¢">
    <select id="filterWorld">
      <option value="">è¦ªï¼ˆã™ã¹ã¦ï¼‰</option>
    </select>
    <select id="filterRace">
      <option value="">ç¨®æ—ï¼ˆã™ã¹ã¦ï¼‰</option>
    </select>
    <select id="filterAttr">
      <option value="">å±æ€§ï¼ˆã™ã¹ã¦ï¼‰</option>
    </select>
    <select id="filterGender">
      <option value="">æ€§åˆ¥ï¼ˆã™ã¹ã¦ï¼‰</option>
    </select>
  </div>

  <!-- ã‚­ãƒ£ãƒ©ä¸€è¦§ -->
  <div class="character-list" id="characterList">
    <!-- ã“ã“ã«ã‚­ãƒ£ãƒ©ã‚«ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã‚‹ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ç”Ÿæˆã—ãŸHTMLï¼‰ -->




   <script>

const WORLDER = [
  'Licht','æšæœˆãƒ•ã‚£ã‚ªãƒŠ','ãã¿ã¾ã‚‹','è¡£ä¾è°·','mol','ãƒ‰ãƒ³ã‚¹ãƒˆãƒƒãƒ—èµ¤éƒ¨å­','ç±³ç²’','ã‚†ã†ã²'
];

const RACES = [
// äººå‹
  'äººé–“','ç¥æ§˜','æ—¥æœ¬ç¥è©±','å¤©ä½¿','æ‚ªé­”','é­”ç‰©',
// å¦–ç²¾
  'ã‚¢ãƒ¡ãƒªã‚«','ã‚¤ã‚®ãƒªã‚¹','ãƒ•ãƒ©ãƒ³ã‚¹','ãƒ‰ã‚¤ãƒ„','ã‚¤ã‚¿ãƒªã‚¢','æ—¥æœ¬','ã‚½ãƒ“ã‚¨ãƒˆ','ä¸­è¯æ°‘å›½','ãƒ•ã‚£ãƒ³ãƒ©ãƒ³ãƒ‰','ãƒ«ãƒ¼ãƒãƒ‹ã‚¢',
// ç£äºº
  'æ¡œçµ„','æ¤¿çµ„','äº¬','æ±Ÿæˆ¸','æ”¾æµª','å¤§æ±Ÿå±±','éˆ´é¹¿å±±','ä¼Šå¹å±±','ç¥æ ¼','æ‚ªé¬¼','é›…è¡†','çœŸå®µè¡†','åœ°ç„','ä¸ƒä»™é¬¼','åäºŒå¤©å°†','å¤§è›‡å…«å‚‘','ã‚ãã‚åºµ','æœˆã®å®®','ç‰å…','ãƒãƒ³ãƒ‰',
// çˆ¬è™«é¡
  'é»’ç™¾åˆ','ç™½ç™¾åˆ',
// é­šäºº
  'è–æ•™ä¼š','å§‹ç¥–','çœ·å±',
// äºœäºº
  'å‰µæ¦‚','ç•°ç•Œæ¸¡ã‚Š',
// äºœäºº
  'CoC','ã‚·ãƒãƒ“ã‚¬ãƒŸ',
];

const ATTR_ORDER = [
  'ç«å±æ€§','é›·å±æ€§','æ°´å±æ€§','æ°·å±æ€§','æœ¨å±æ€§','é¢¨å±æ€§','åœŸå±æ€§','å²©å±æ€§','ç„¡å±æ€§','å…‰å±æ€§','é—‡å±æ€§','æ—¥å±æ€§','æœˆå±æ€§','æ˜Ÿå±æ€§'
];

const GENDER_ORDER = [
  'ç”·æ€§','å¥³æ€§','ç„¡'
];

let allCharacters = [];

    // JSONãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
    async function loadCharacters() {
      const res = await fetch("sanzen-characters.json"); // JSONãƒ•ã‚¡ã‚¤ãƒ«åã‚’åˆã‚ã›ã¦ã­
      const characters = await res.json();
      allCharacters = characters; // â˜…ä¿æŒ
      renderCharacters(characters);
      populateFilters(characters);
    }

    // HTMLã«ã‚­ãƒ£ãƒ©ã‚’æç”»
    function renderCharacters(characters) {
      const container = document.getElementById("characterList");
      container.innerHTML = "";

      characters.forEach(c => {
        const card = document.createElement("div");
        card.className = "character-card";
        card.dataset.name = c.name;
        card.dataset.world = c.world;
        card.dataset.race = c.race || c.affiliation || c.aaffiliation || "";
        card.dataset.attr = c.attribute;
        card.dataset.gender = c.gender;

        card.innerHTML = `
        <a href="${c.detailUrl}">
          <img src="${c.icon}" alt="${c.name}">
          <h3>${c.name}</h3>
         </a>
        `;
        container.appendChild(card);

        
      });
    }

    // ãƒ•ã‚£ãƒ«ã‚¿é …ç›®ã‚’ä½œæˆ
    function populateFilters(characters) {
      const worlds = new Set();
      const races = new Set();
      const attrs = new Set();
      const genders = new Set();

      characters.forEach(c => {
        if (c.world) worlds.add(c.world);
        if (c.race || c.affiliation || c.aaffiliation) races.add(c.race || c.affiliation || c.aaffiliation);
        if (c.attribute) attrs.add(c.attribute);
        if (c.gender) genders.add(c.gender);
      });

      function fillSelect(id, values) {
        const select = document.getElementById(id);
        [...values].forEach(v => {
          const opt = document.createElement("option");
          opt.value = v;
          opt.textContent = v;
          select.appendChild(opt);
        });
      }

        updateRaceByWorld('');

          fillSelect("filterWorld", WORLDER);
      fillSelect("filterAttr", ATTR_ORDER);
      fillSelect("filterGender", GENDER_ORDER);
    }

    function updateRaceByWorld(world) {
  const select = document.getElementById("filterRace");

  // ä»Šã®é¸æŠã‚’é€€é¿
  const current = select.value;

  // åˆæœŸåŒ–
  select.innerHTML = '<option value="">ç¨®æ—ï¼ˆã™ã¹ã¦ï¼‰</option>';

  // å¯¾è±¡ã‚­ãƒ£ãƒ©ã‚’çµã‚‹
  const targets = world
    ? allCharacters.filter(c => c.world === world)
    : allCharacters;

  // ç¨®æ—ã‚’æŠ½å‡ºï¼ˆé‡è¤‡é˜²æ­¢ï¼‰
  const set = new Set();
  targets.forEach(c => {
    const r = c.race || c.affiliation || c.aaffiliation;
    if (r) set.add(r);
  });

  // RACES ã®é †ç•ªã‚’ç¶­æŒã—ã¦è¿½åŠ 
  // RACES ã®é †ç•ªã§å­˜åœ¨ã™ã‚‹ã‚‚ã®ã‚’è¿½åŠ ã—ã€ã‚»ãƒƒãƒˆã‹ã‚‰å‰Šé™¤
  RACES.forEach(r => {
    if (set.has(r)) {
      const opt = document.createElement("option");
      opt.value = r;
      opt.textContent = r;
      select.appendChild(opt);
      set.delete(r);
    }
  });

  // RACES ã«ãªã„æ®‹ã‚Šã®ç¨®æ—ã‚’ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆ/äº”åéŸ³é †ã§è¿½åŠ 
  Array.from(set).sort().forEach(r => {
    const opt = document.createElement("option");
    opt.value = r;
    opt.textContent = r;
    select.appendChild(opt);
  });

  // ã¾ã æœ‰åŠ¹ãªã‚‰é¸æŠã‚’å¾©å…ƒ
  if ([...select.options].some(o => o.value === current)) {
    select.value = current;
  }
}


    // ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½
    function filterCharacters() {
      const search = document.getElementById('searchBox').value.toLowerCase();
      const world = document.getElementById('filterWorld').value;
      const race = document.getElementById('filterRace').value;
      const attr = document.getElementById('filterAttr').value;
      const gender = document.getElementById('filterGender').value;

      document.querySelectorAll('.character-card').forEach(card => {
        const match =
          card.dataset.name.toLowerCase().includes(search) &&
          (!world || card.dataset.world === world) &&
          (!race || card.dataset.race === race) &&
          (!attr || card.dataset.attr === attr) &&
          (!gender || card.dataset.gender === gender);

        card.style.display = match ? 'block' : 'none';
      });
    }

document.addEventListener("input", e => {
  if (!e.target.closest(".filters")) return;

  // ãƒ¯ãƒ¼ãƒ«ãƒ‰ãŒå¤‰ã‚ã£ãŸã‚‰ç¨®æ—ã‚’æ›´æ–°
  if (e.target.id === "filterWorld") {
    updateRaceByWorld(e.target.value);
  }

  filterCharacters();
});


    document.addEventListener("DOMContentLoaded", loadCharacters);
  </script>

</body>
</html>

