<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <!-- ← これを追加 -->
  <title>キャラクター図鑑</title>
 <link rel="stylesheet" href="characters.css"> <!-- CSSを外部ファイルで読み込み -->

</head>
<body>
  <h1>キャラクター図鑑</h1>

 <!-- ヘッダー -->
  <header>
    <nav>
      <a href="index.html">トップ</a>
      <a href="Лаплавень.html">Лаплавень</a>
      <a href="World WAR a VisiON.html">World WAR a VisiON</a>
      <a href="妖行脚百鬼夜行物語.html">妖行脚百鬼夜行物語</a>
      <a href="不毛論争.html">不毛論争</a>
      <a href="Lisnoir.html">Lisnoir</a>
      <!-- 必要に応じて作品を追加 -->
    </nav>
  </header>


  <!-- 🔍 検索フォーム -->
  <div class="filters">
    <input type="text" id="searchBox" placeholder="名前で検索">
    <select id="filterWorld">
      <option value="">作品（すべて）</option>
    
    </select>
    <select id="filterAffiliation">
      <option value="">所属（すべて）</option>

         </select>
    <select id="filterAttr">
      <option value="">属性（すべて）</option>

    </select>
    <select id="filterGender">
      <option value="">性別（すべて）</option>

    </select>
  </div>

  <!-- キャラ一覧 -->
  <div class="character-list" id="characterList">
    <!-- ここにキャラカードを貼り付ける（スプレッドシートから生成したHTML） -->




   <script>
    // JSONファイルの読み込み
    async function loadCharacters() {
      const res = await fetch("characters.json"); // JSONファイル名を合わせてね
      const characters = await res.json();
      renderCharacters(characters);
      populateFilters(characters);
    }

    // HTMLにキャラを描画
    function renderCharacters(characters) {
      const container = document.getElementById("characterList");
      container.innerHTML = "";

      characters.forEach(c => {
        const card = document.createElement("div");
        card.className = "character-card";
        card.dataset.name = c.name;
        card.dataset.world = c.world;
        card.dataset.affiliation = c.affiliation || c.aaffiliation || "";
        card.dataset.attr = c.attribute;
        card.dataset.gender = c.gender;

        card.innerHTML = `
        <a href="${c.detailUrl}">
          <img src="${c.image}" alt="${c.name}">
          <h3>${c.name}</h3>
         </a>
        `;
        container.appendChild(card);

        
      });
    }

    // フィルタ項目を作成
    function populateFilters(characters) {
      const worlds = new Set();
      const affiliations = new Set();
      const attrs = new Set();
      const genders = new Set();

      characters.forEach(c => {
        if (c.world) worlds.add(c.world);
        if (c.affiliation || c.aaffiliation) affiliations.add(c.affiliation || c.aaffiliation);
        if (c.attribute) attrs.add(c.attribute);
        if (c.gender) genders.add(c.gender);
      });

      function fillSelect(id, values) {
        const select = document.getElementById(id);
        [...values].sort().forEach(v => {
          const opt = document.createElement("option");
          opt.value = v;
          opt.textContent = v;
          select.appendChild(opt);
        });
      }

      fillSelect("filterWorld", worlds);
      fillSelect("filterAffiliation", affiliations);
      fillSelect("filterAttr", attrs);
      fillSelect("filterGender", genders);
    }

    // フィルタ機能
    function filterCharacters() {
      const search = document.getElementById('searchBox').value.toLowerCase();
      const world = document.getElementById('filterWorld').value;
      const affiliation = document.getElementById('filterAffiliation').value;
      const attr = document.getElementById('filterAttr').value;
      const gender = document.getElementById('filterGender').value;

      document.querySelectorAll('.character-card').forEach(card => {
        const match =
          card.dataset.name.toLowerCase().includes(search) &&
          (!world || card.dataset.world === world) &&
          (!affiliation || card.dataset.affiliation === affiliation) &&
          (!attr || card.dataset.attr === attr) &&
          (!gender || card.dataset.gender === gender);

        card.style.display = match ? 'block' : 'none';
      });
    }

    document.addEventListener("input", e => {
      if (e.target.closest(".filters")) filterCharacters();
    });

    document.addEventListener("DOMContentLoaded", loadCharacters);
  </script>

</body>
</html>

